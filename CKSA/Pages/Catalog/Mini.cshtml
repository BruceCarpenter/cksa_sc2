@page "/shop/{ShopName}/{SubCategoryName}/{ShopId}/{CategoryId}/{SubCategoryId}"
@using CKSA.Helpers
@model CKSA.Pages.Catalog.MiniModel
@{
}

@if (Response.StatusCode == 410)
{
    <div>
        This product is no longer available. Here are similar items you may like.
    </div>
}

<div id="subMast" class="container">
    <div class="row">
        <nav id="breadCrumb" class="col-xs-12">
            <ul>
                @if (Model.MiniDataModel.Breadcrumbs != null)
                {
                    foreach (var c in Model.MiniDataModel.Breadcrumbs)
                    {
                        <li>
                            <a href="@c.Value">@c.Key</a>
                        </li>
                    }
                }
            </ul>
        </nav>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-xs-12" style="padding-left:0;">
            <h1>@Model.MiniDataModel.H1Tag</h1>
        </div>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-xs-12" style="padding-top:10px;">
            <p>@Html.Raw(Model.MiniDataModel.GeneralDescription)</p>
        </div>
    </div>
</div>

<div class="container">
    <div class="row titleRow">
        <div class="col-xs-12 col-sm-7 col-md-7 col-lg-4" style="padding-left:0;">
        </div>
        <div class="col-xs-12 col-sm-7 col-md-7 col-lg-4" style="padding-left:0;">
            @Model.F.NumberResults Results. Use the filters to narrow results.
        </div>
        <div class="col-xs-12 col-sm-5 col-md-5 col-lg-4 sortWrap">
            <span id="sortText">Sort by:</span>
            <select class="form-control" id='sortChange' name='sortChange' aria-label="Sort by">
                <option value="0">Item Number</option>
                <option value="1">Newest</option>
                <option value="2">Popularity</option>
                <option value="3">Price: High to Low</option>
                <option value="4">Price: Low to High</option>
            </select>
        </div>
    </div>
</div>

<div class="container">
    <div class="row">
        @{
            var showMoreMax = 3;
        }

        @if (Model.F.TheFilters.Count > 0)
        {
            <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                <div id="filterBar">
                    <div id="filterHd">Filter</div>
                    <div id="formFilters">
                        @for (int sIdx = 0; sIdx < Model.F.TheFilters.Count; sIdx++)
                        {
                            var fg = Model.F.TheFilters[sIdx];
                            var sCounter = sIdx + 1; @* To match your 1-based JS ShowMore *@

                            <span style="color:#492408; margin-bottom:.75em; font-size:25px; margin-top:20px; display:block;">
                                @fg.FilterGroupName
                            </span>

                            @for (int fIdx = 0; fIdx < fg.Filters.Count; fIdx++)
                            {
                                var f = fg.Filters[fIdx];
                                @* Razor handles the class logic much cleaner here *@
                                <div class="checkbox @(fIdx > showMoreMax ? $"alternate{sCounter}" : "")">
                                    <label>
                                        <input type="checkbox" name="@fg.FilterGroupName" value="@f.FilterId" @(f.IsFilterUiSet=="checked" ? "checked" : "") />
                                        @f.FilterName (@f.Count)
                                    </label>
                                </div>
                            }

                            if (fg.Filters.Count > showMoreMax + 1)
                            {
                                <div style="text-align:right;">
                                    <a id="tgl@sCounter" href="javascript:ShowMore(@sCounter);">Show More</a>
                                </div>
                            }
                        }
                        <hr />
                        <input class="btn btn-default filterBt" type="submit" value="Clear" style="width:100%;" onclick="ClearFilters()">
                    </div>
                </div>
            </div>
        }

        <div class="col-xs-12 col-sm-9 col-md-9 col-lg-9 prodGrid">
            @foreach (var i in Model.F.Products)
            {
                <div class="col-xs-12 col-sm-4">
                    <div class="card">
                        @* Assuming these are helper methods in your PageModel or a static helper *@
                        @Html.Raw(MiniHelper.MiniLoad(i.ItemNumber, i.ItemId, i.Description, i.FriendlyUrlLink, i.MasterItemNumber, i.ImageName))

                        <div class="pProduct">
                            <div style="text-overflow: ellipsis; height: 2em;">
                                <a href="@i.FriendlyUrlLink"><h3>@i.Description</h3></a>
                            </div>

                            <div style="min-height:1em;">
                                @if (i.PriceRange == null)
                                {
                                    @i.UnitsBBDate()
                                }
                            </div>

                            <div>
                                @Html.Raw(MiniHelper.FormatUnitPrice(i.Price, i.SalePrice, i.SaleEndCKPS, i.PriceRange, i.SalePriceRange))
                            </div>

                            <div style="min-height:1em;">
                                @if (i.PriceRange == null)
                                {
                                    @i.ItemNumber
                                }
                            </div>

                            @Html.Raw(Model.CreateMoreButton(i))

                            @if (i.PriceRange == null)
                            {
                                @Html.Raw(CkHtmlHelper.AddItemButton(i.ItemNumber, i.TempOutOfStock, i.CKPSpecial, i.DateEndCKPS, i.SaleEndCKPS, i.QuanitityCKPS, i.Price, i.IsUnit, i.FriendlyUrlLink))
                            }
                            else
                            {
                                @Html.Raw(Model.UnitOptionsText(i));
                            }
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
    <a id="back-to-top" href="#" class="btn btn-primary btn-lg back-to-top" role="button">
        <span class="glyphicon glyphicon-chevron-up"></span>
    </a>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

    <script src='~/js/mini.js'></script>
    <script>
        $(document).ready(function () {
                    $(window).scroll(function () {
                        if ($(this).scrollTop() > 50) {
                            $('#back-to-top').fadeIn();
                        } else {
                            $('#back-to-top').fadeOut();
                        }
                    });
                    // scroll body to 0px on click
                    $('#back-to-top').click(function () {
                        $('#back-to-top').tooltip('hide');
                        $('body,html').animate({
                            scrollTop: 0
                        }, 800);
                        return false;
                    });

                    $('[data-toggle="popover"]').popover({
                        html: true,
                        trigger: "hover",
                        placement: "top",
                        content: function () {
                            var qty1 = $(this).data("qty1");
                            var price1 = $(this).data("price1");
                            var qty2 = $(this).data("qty2");
                            var price2 = $(this).data("price2");

                            return `
                    <div style="width: 160px; font-size: 14px; border: 1px solid #ccc;">
                        <!-- Title Section -->
                        <div style="background-color: #f8f8f8; padding: 5px; text-align: center; font-weight: bold;">
                            Quantity Discounts
                        </div>
                        <hr style="margin: 0; border-top: 1px solid #ccc;">

                        <!-- First Quantity-Price Row -->
                        <div style="display: flex; width: 100%; padding: 0px 0; text-align: center;">
                            <div style="width: 50%; border-right: 1px solid #ccc;">${qty1}</div>
                            <div style="width: 50%;">${price1}</div>
                        </div>
                        <hr style="margin: 0; border-top: 1px solid #ccc;">

                        <!-- Second Quantity-Price Row -->
                        <div style="display: flex; width: 100%; padding: 0px 0; text-align: center;">
                            <div style="width: 50%; border-right: 1px solid #ccc;">${qty2}</div>
                            <div style="width: 50%;">${price2}</div>
                        </div>
                    </div>
                `;
                        }
                });

                    //$('#back-to-top').tooltip('show');

                var selectedFilter = getParameterByName("sort");
                if (selectedFilter) $("#sortChange").val(selectedFilter);
              });
    </script>
}