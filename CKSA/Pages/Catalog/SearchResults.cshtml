@page
@model CKSA.Pages.Catalog.SearchResultsModel
@section Head {
    <meta name="robots" content="noindex, follow">



    <style>
        .alternative_cls:nth-child(even) {
            background: #fff;
            padding-top: 3px;
            padding-bottom: 3px;
        }

        .alternative_cls:nth-child(odd) {
            background: #eee;
            padding-top: 3px;
            padding-bottom: 3px;
        }
    </style>
}
@{
}

@if (Model.F.NumberResults > 0)
{
    <div class="container">
        <div class="row titleRow">
            <div class="col-xs-6 col-sm-5 col-md-5 col-lg-4 sortWrap">
                <span id="sortText">Sort by:</span>

                @* Use asp-for to automatically select the current sort option *@
                <select class="form-control" id="sortChange" name="sortChange">
                    <option value="0">Item Number</option>
                    <option value="1">Newest</option>
                    <option value="2">Popularity</option>
                    <option value="3">Price: High to Low</option>
                    <option value="4">Price: Low to High</option>
                </select>
            </div>

            <div class="col-xs-6">
                @* Assuming PageControl() returns an HTML string *@
                <div style="text-align:right;float:right;">@Html.Raw(Model.PageControl())</div>
            </div>
        </div>
    </div>
}
else
{
    <div class="container">
        <div style="text-align:left;padding:20px 0px 60px 0px;font-size:1.2em;">
            No results were found for your search: <strong>@Model.PartialMatchString()</strong>.
        </div>
    </div>
}

            <div class="container">
    <div class="row">
        @* --- FILTERS SIDEBAR --- *@
        @if (Model.F.TheFilters.Count > 0 || Model.SubCategories.Count > 0)
        {
            <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                <div id="filterBar">
                    <div id="filterHd">Filter</div>
                    <div id="formFilters">
                        @{
                            var ShowMoreMax = 3;
                            var counter = 0;
                        }

                        @if (Model.SubCategories.Count > 0)
                        {
                            <h4>Categories</h4>
                        }

                        @foreach (var c in Model.SubCategories)
                        {
                            <div class="@(counter > ShowMoreMax ? "alternate0 alternative_cls" : "alternative_cls")">
                                <a href="@c.Value">@c.Key</a>
                            </div>
                            counter++;
                        }

                        @if (counter > ShowMoreMax + 1)
                        {
                            <div style="text-align:right;"><a id="tgl0" href="javascript:ShowMore(0);">Show More</a></div>
                        }

                        @{ var sCounter = 1; }
                        @foreach (var fg in Model.F.TheFilters)
                        {
                            <h4>@fg.FilterGroupName</h4>
                            var counter2 = 0;
                            @foreach (var f in fg.Filters)
                            {
                                <div class="@(counter2 > ShowMoreMax ? $"alternate{sCounter} checkbox" : "checkbox")">
                                    <label>
                                        <input type="checkbox" name="@fg.FilterGroupName" value="@f.FilterId" @(f.IsFilterUiSet) />
                                        @f.FilterName (@f.Count)
                                    </label>
                                </div>
                                counter2++;
                            }
                            if (counter2 > ShowMoreMax + 1)
                            {
                                <div style="text-align:right;"><a id="tgl@sCounter" href="javascript:ShowMore(@sCounter);">Show More</a></div>
                            }
                            sCounter++;
                        }
                        <hr />
                        <input class="btn btn-default filterBt" type="submit" value="Clear" style="width:100%;" onclick="ClearFilters()">
                    </div>
                </div>
            </div>
        }

        @* --- PRODUCT GRID --- *@
        <div class="col-xs-12 col-sm-9 col-md-9 col-lg-9">
            Images should be here.
            @if (Model.F.Products != null)
            {
                int switchNum = 0;
                bool open = false;

                @for (int j = 0; j < Model.F.Products.Count; j++)
                {
                    var i = Model.F.Products[j];

                    @* Section Logic: Exact Matches *@
                    if (i.HowFound == 1 && switchNum < 1)
                    {
                        switchNum = 1; open = true;
                        @:<div> @* The @: tells Razor this is a literal start tag *@
                        <div class="col-xs-12" style="font-size:1.2em;height:auto;background:#fff;margin: 0px 5px 5px 5px;">
                            <div>Your search returned @Model.F.SearchCount[1] product matches with the term <strong>@Model.ExactMatchString()</strong>.</div>
                        </div>
                    }
                    @* Section Logic: Partial Matches *@
                    else if (i.HowFound == 2 && switchNum < 2)
                    {
                        if (open) { @:</div> 
                        }
                        switchNum = 2; open = true;
                        @:<div>
                        <div class="col-xs-12" style="font-size:1.2em;height:auto;background:#fff;margin: 0px 5px 5px 5px;">
                            @if (Model.F.PageToGet == 0)
                            {
                                <div>Your search results found 0 products with the term <strong>@Model.ExactMatchString()</strong>.</div>
                            }
                            <div>Your search returned @Model.F.SearchCount[2] product matches with the term <strong>@Model.PartialMatchString()</strong>.</div>
                        </div>
                    }
                    @* Section Logic: Additional Results *@
                    else if (i.HowFound == 3 && switchNum < 3)
                    {
                        if (open) { @:</div> 
                        }
                        switchNum = 3; open = true;
                        @:<div>
                        <div class="col-xs-12" style="font-size:1.2em;height:auto;margin: 0px 5px 5px 5px;">
                            Below are additional search results containing a form of <strong>@Model.PartialMatchString()</strong>.
                        </div>
                    }

                    @* Product Card *@
                    <div class="col-xs-12 col-sm-4">
                        <div class="card">
                            @Html.Raw(Model.MiniLoad(i.ItemNumber, i.ItemId, i.Description, i.FriendlyUrlLink, i.MasterItemNumber, i.ImageName))
                            <p>
                                <b><a href="@i.FriendlyUrlLink">@Model.Description(i.Description)</a></b><br />
                                Units: @i.Units<br />
                                Price: @Html.Raw(Model.FormatPrice(i.Price, i.SalePrice, i.SaleEndCKPS))
                            </p>
                            <a href="@i.FriendlyUrlLink" class="button moreBt">More Info</a>
                            @Html.Raw(ckLib.CkHtmlHelper.AddItemButton(i.ItemNumber, i.TempOutOfStock, i.CKPSpecial, i.DateEndCKPS, i.SaleEndCKPS, i.QuanitityCKPS, i.Price, false, i.FriendlyUrlLink))
                        </div>
                    </div>
                }
                
                if (open) { @:</div> 
                }
            }
        </div>
    </div> @* end row *@

    <div class="row">
        <div class="col-xs-3 pull-right">
            @Html.Raw(Model.PageControl())
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src='~/js/mini.min.js'></script>

    <script>

      $(document).ready(function () {
        var selectedFilter = getParameterByName("sort");
        if (selectedFilter) $("#sortChange").val(selectedFilter);
        else $("#sortChange").val("2");

          $("#searchValue").val('@Model.SearchTerm');

      });
    </script>
}