@page "/idea/{name}/{typename}/{id}/{typeid}/{ideaid}"
@using ckLib
@model CKSA.Pages.Idea.ckIdeaModel
@section Head {
    <meta property="og:image" content=@Model.IdeaModel.ImageUrl />
    <meta property="og:url" content="@Model.IdeaModel.FB" />
    <meta property="og:title" content="@Model.IdeaModel.FbTitle" />
    <meta property="og:description" content="@Model.IdeaModel.Description" />

    <link rel="stylesheet" media="screen" type="text/css" href="~/blog/blog.css" />
    <link rel="stylesheet" media="print" title="Printer-Friendly Style" type="text/css" href="~/css/print.css" />

    <script async defer src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
   <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script async defer src='~/js/product.js'></script>

    @Model.JsonRecipe()
}
@{
}

<div id="subMast" class="container">
    <div class="row">
        <nav id="breadCrumb" class="col-xs-12">
            <ul>
                @foreach (var (name, url) in Model.IdeaModel.Breadcrumbs)
                {
                    <li>
                        <a href="@url">@name</a>
                    </li>
                }
            </ul>
        </nav>
    </div>
</div>

@* C# 8 Logic Block at the top *@
@{
    // Use the Range operator to take up to 7 images safely
    var displayImages = Model.IdeaModel.AltImages.Take(7).ToArray();
    var displayMinis = Model.IdeaModel.MiniAltImages.Take(7).ToArray();
}

<div class="container" style="margin-top:2em;">
    <div class="row">
        @if (displayImages.Any())
        {
            @* Desktop View *@
            <div class="hidden-xs col-sm-1 col-md-1 col-lg-1">
                <div class="verticalThumbs">
                    @for (int i = 0; i < displayImages.Length; i++)
                    {
                        <img class="altImage noPrint" alt="alternative image"
                             src="@displayMinis[i]" data-large="@displayImages[i]">
                    }
                </div>
            </div>

            @* Mobile View *@
            <div class="hidden-sm hidden-md hidden-lg">
                <div class="verticalThumbs">
                    @for (int i = 0; i < displayImages.Length; i++)
                    {
                        <div class="col-xs-6">
                            <img class="altImage noPrint" alt="alternative image"
                                 src="@displayMinis[i]" data-large="@displayImages[i]" />
                        </div>
                    }
                </div>
            </div>
        }

        <div class="col-xs-12 col-sm-7 col-md-7 col-lg-7">
            <div class="wrapperIdea">
                <img id="imgMainIdea" src="@Model.IdeaModel.ImageUrl" alt="@Model.IdeaModel.TitleTxt" title="@Model.IdeaModel.TitleTxt" />
                <span class="glyphicon glyphicon-zoom-in"></span>
            </div>
        </div>

        <div class="col-xs-12 col-sm-4 col-md-4 col-lg-4 productInfo">
            <div style="font-size:1.2em;margin:0;padding-bottom:10px;">
                <h1>@Model.IdeaModel.FbTitle</h1>
            </div>
            <div style="color:grey;padding-bottom:5px;font-size:1.15em;">
                Idea gallery #@Model.IdeaModel.IdeaNumber
            </div>
            <ul>
                @foreach (var ingredient in Model.IdeaModel.Ingredients)
                {
                    <li>@ingredient</li>
                }
            </ul>
            @* Use Html.Raw if Instructions contains HTML markup *@
            @Html.Raw(Model.IdeaModel.Instructions)
            <div class="col-lg-7 col-xs-12">
            </div>
        </div>
    </div>
</div>


@if (Model.IdeaModel.Videos?.Count > 0)
{
    <div class="container">
        <div><hr /></div>
        <h2>Videos:</h2>
        <div class="row" style="padding-bottom:16px;">
            @foreach (var v in Model.IdeaModel.Videos)
            {
                <div class="col-md-6">
                    <div class="embed-responsive embed-responsive-16by9">
                        @* C# 8/Razor handles the attribute merging perfectly here *@
                        <iframe title="Video on @v.Name"
                                src="@v.Url"
                                allow="encrypted-media"
                                allowfullscreen>
                        </iframe>
                    </div>
                </div>
            }
        </div>
    </div>
}

<div class="container">
    <div class="row">
        <div class="col-xs-12">
            <p>@Model.IdeaModel.GenDescription</p>
        </div>
    </div>
</div>

<div class="noPrint" style="padding-top:10px;">
    <div><hr /></div>
    <div><h2>Shop Products Used: </h2></div>
    @* We pass Model.MiniProducts into the partial's @model *@
    <partial name="_Mini" model="Model._MiniImageModel" />
</div>

@section Scripts {
    <script>
        window.addEventListener('load', checkJSLoaded);

        function checkJSLoaded() {
            // create the script element
            let script = document.createElement('script');

            // assign an onload event handler
            script.addEventListener('load', (event) => {
                    $('#imgMainIdea').elevateZoom({
                    zoomType: "inner",
                    cursor: "crosshair",
                    zoomWindowFadeIn: 500,
                    zoomWindowFadeOut: 750
                });

            $('.altImage').click(function () {
                $('#imgMainIdea').prop('src', $(this).data().large);
                $('#imgMainIdea').elevateZoom({
                    zoomType: "inner",
                    cursor: "crosshair",
                    zoomWindowFadeIn: 500,
                    zoomWindowFadeOut: 750
                });
            });

            });

            // load the script file
            script.src = '/js/jquery.elevatezoom-3.0.8.min.js';
            document.body.appendChild(script);
        }
    </script>

    <script>
          $(document).ready(function ($) {
              $(".navbar img").attr("data-pin-nopin", "true");
          });
          window.fbAsyncInit = function () {
              FB.init({
                  appId: '2375110472676556',
                  autoLogAppEvents: true,
                  xfbml: true,
                  version: 'v16.0'
              });
          };

          function FacebookShare() {
              FB.ui({
                  display: 'popup',
                  method: 'share',
                  href: '<%=Canonical%>',
        }, function (response) { });
          }

          $('#PinDiv').append("<a href='<%=Pinit%>' class='pin-it-button'></a>");
              $('#fbDiv').append("<div class='fb-like' data-href='<%=FB%>' data-width='' data-layout='button' data-action='like' data-size='small' data-share='true'></div>");

          function blogSearch() {
              var searchFor = document.getElementById('blogSearch').value;
              if (searchFor != '')
                  window.location.href = "/blog/default.aspx?search=" + encodeURIComponent(searchFor);
          }

          document.getElementById("blogSearch").addEventListener("keydown", function (event) {
              if (event.keyCode === 13) {
                  blogSearch();
              }
          });

    </script>



}